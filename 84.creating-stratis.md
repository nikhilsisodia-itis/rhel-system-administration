# Creating Stratis in RHEL

## Prerequisites

- Ensure you have root or sudo access to the RHEL system.
- Make sure your system is running RHEL 8 or later, as Stratis is included in these versions.
- Install the Stratis package if it is not already installed. You can do this using the following command:

  ```bash
  sudo dnf install stratis-cli stratisd
  ```

- Ensure that the Stratis service is enabled and running:

  ```bash
  sudo systemctl enable --now stratisd
  sudo systemctl start stratisd
  ```

- Identify the block devices you want to use for creating a Stratis pool. You can list available block devices using the `lsblk` command:

  ```bash
  lsblk
  ```

- Make sure the block devices are not in use and do not contain any important data, as creating a Stratis pool will erase all data on the selected devices.
- Ensure that you have the necessary permissions to create and manage storage pools and volumes on the system.

## Steps to Create a Stratis Pool and Volume

1. **Create a Stratis Pool**:
   Use the `stratis pool create` command to create a new Stratis pool. Replace `<pool_name>` with your desired pool name and `<device1> <device2>` with the block devices you identified earlier.

   ```bash
   sudo stratis pool create <pool_name> <device1> <device2>
   ```

   Example:

   ```bash
   sudo stratis pool create mypool /dev/sdb /dev/sdc
   ```

2. **Add more devices to the Pool (Optional)**:
   If you want to add more devices to the existing pool, use the following command:

   ```bash
   sudo stratis pool add <pool_name> <new_device>
   ```

   Example:

   ```bash
   sudo stratis pool add mypool /dev/sdd
   ```

3. **List Stratis Pools**:
   Verify that the pool has been created successfully by listing all Stratis pools:

   ```bash
   stratis pool list
   ```

4. **List block devices in the Pool**:
   To see the block devices associated with a specific pool, use:

   ```bash
   stratis blockdev list
   ```

5. **Create file system on the Pool**:
   Before creating a volume, you need to create a file system on the pool. Use the following command:

   ```bash
   sudo stratis filesystem create <pool_name> <filesystem_name>
   ```

   Example:

   ```bash
   sudo stratis filesystem create mypool myfs
   ```

6. **Create a directory to mount the filesystem**:
   Create a directory where you will mount the Stratis filesystem:

   ```bash
   sudo mkdir /mnt/myfs
   ```

7. **Mount the Stratis filesystem**:
   Mount the Stratis filesystem to the directory you created:

   ```bash
   sudo mount -t stratis <pool_name>/<filesystem_name> <mount_point>
   ```

   Example:
  
   ```bash
   sudo mount -t stratis mypool/myfs /mnt/myfs
   ```

8. **Verify the mount**:
   Check that the filesystem is mounted correctly by using the `df -h` command:

   ```bash
   df -h
   ```

9. **Set up automatic mounting (Optional)**:
   To ensure that the Stratis filesystem mounts automatically at boot, add an entry to the `/etc/fstab` file. Open the file in a text editor:

   ```bash
   sudo vim /etc/fstab
   ```

   Add the following line at the end of the file:

   ```vim
   <pool_name>/<filesystem_name> <mount_point>
   OR
   UUID=<UUID_of_the_filesystem> <mount_point> <file_system> defaults,x-systemd.requires=stratisd.service 0 0
   ```

   Example:

   ```vim
   mypool/myfs /mnt/myfs xfs defaults,x-systemd.requires=stratisd.service 0 0
   OR
   UUID=<UUID_of_the_filesystem> /mnt/myfs xfs defaults,x-systemd.requires=stratisd.service 0 0
   ```

   Save and exit.

10. **Reload**:
   After editing the `/etc/fstab` file, execute `mount -a` and `systemctl daemon-reload` command.
   The `mount -a` command mounts all filesystems mentioned in /etc/fstab that are not marked noauto and are not already mounted.
   The `systemctl daemon-reload` command re-read unit files and its configuration.
